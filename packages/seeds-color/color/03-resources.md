## Resources

### Links

- [Contrast Grid](http://contrast-grid.eightshapes.com/?background-colors=%23d7f4d7%2C%20green%20100%0D%0A%23bbedb6%2C%20green%20200%0D%0A%2398e58e%2C%20green%20300%0D%0A%2375dd66%2C%20green%20400%0D%0A%2359cb59%2C%20green%20500%0D%0A%232bb656%2C%20green%20600%0D%0A%230ca750%2C%20green%20700%0D%0A%23008b56%2C%20green%20800%0D%0A%23007549%2C%20green%20900%0D%0A%23bdf4ea%2C%20teal%20100%0D%0A%238aedde%2C%20teal%20200%0D%0A%2357e7d1%2C%20teal%20300%0D%0A%2324e0c5%2C%20teal%20400%0D%0A%2308c4b2%2C%20teal%20500%0D%0A%2300a99c%2C%20teal%20600%0D%0A%230b968f%2C%20teal%20700%0D%0A%23067c7c%2C%20teal%20800%0D%0A%23026661%2C%20teal%20900%0D%0A%23baf6f7%2C%20aqua%20100%0D%0A%238debf0%2C%20aqua%20200%0D%0A%2360e1e9%2C%20aqua%20300%0D%0A%2333d6e2%2C%20aqua%20400%0D%0A%2317b8ce%2C%20aqua%20500%0D%0A%230797ae%2C%20aqua%20600%0D%0A%230b8599%2C%20aqua%20700%0D%0A%230f6e84%2C%20aqua%20800%0D%0A%23005a68%2C%20aqua%20900%0D%0A%23c7e4f9%2C%20blue%20100%0D%0A%23a1d2f8%2C%20blue%20200%0D%0A%237cbff6%2C%20blue%20300%0D%0A%2356adf5%2C%20blue%20400%0D%0A%233896e3%2C%20blue%20500%0D%0A%232b87d3%2C%20blue%20600%0D%0A%232079c3%2C%20blue%20700%0D%0A%230d62a9%2C%20blue%20800%0D%0A%23084f8a%2C%20blue%20900%0D%0A%23e3e1f9%2C%20purple%20100%0D%0A%23cecafb%2C%20purple%20200%0D%0A%23bab3fd%2C%20purple%20300%0D%0A%23a193f2%2C%20purple%20400%0D%0A%239180f4%2C%20purple%20500%0D%0A%23816fea%2C%20purple%20600%0D%0A%236f5ed3%2C%20purple%20700%0D%0A%235e4eba%2C%20purple%20800%0D%0A%23483a9c%2C%20purple%20900%0D%0A%23f8d9f9%2C%20magenta%20100%0D%0A%23f6bcf8%2C%20magenta%20200%0D%0A%23f49ff6%2C%20magenta%20300%0D%0A%23f282f5%2C%20magenta%20400%0D%0A%23db61db%2C%20magenta%20500%0D%0A%23c44eb9%2C%20magenta%20600%0D%0A%23ac44a8%2C%20magenta%20700%0D%0A%238f3896%2C%20magenta%20800%0D%0A%237d2784%2C%20magenta%20900%0D%0A%23ffd4e8%2C%20pink%20100%0D%0A%23ffb5d5%2C%20pink%20200%0D%0A%23ff95c1%2C%20pink%20300%0D%0A%23ff76ae%2C%20pink%20400%0D%0A%23ef588b%2C%20pink%20500%0D%0A%23e0447c%2C%20pink%20600%0D%0A%23ce3665%2C%20pink%20700%0D%0A%23b22f5b%2C%20pink%20800%0D%0A%239c1d48%2C%20pink%20900%0D%0A%23ffd5d2%2C%20red%20100%0D%0A%23ffb8b1%2C%20red%20200%0D%0A%23ff9c8f%2C%20red%20300%0D%0A%23ff7f6e%2C%20red%20400%0D%0A%23f76054%2C%20red%20500%0D%0A%23ed4c42%2C%20red%20600%0D%0A%23db3e3e%2C%20red%20700%0D%0A%23c63434%2C%20red%20800%0D%0A%23af3131%2C%20red%20900%0D%0A%23ffdbc7%2C%20orange%20100%0D%0A%23ffc6a4%2C%20orange%20200%0D%0A%23ffb180%2C%20orange%20300%0D%0A%23ff9c5d%2C%20orange%20400%0D%0A%23fc8943%2C%20orange%20500%0D%0A%23f57d33%2C%20orange%20600%0D%0A%23ed7024%2C%20orange%20700%0D%0A%23db6218%2C%20orange%20800%0D%0A%23c95417%2C%20orange%20900%0D%0A%23fff1c5%2C%20yellow%20100%0D%0A%23ffe99a%2C%20yellow%20200%0D%0A%23ffe16e%2C%20yellow%20300%0D%0A%23ffd943%2C%20yellow%20400%0D%0A%23ffcd1c%2C%20yellow%20500%0D%0A%23ffbc00%2C%20yellow%20600%0D%0A%23efac00%2C%20yellow%20700%0D%0A%23dd9902%2C%20yellow%20800%0D%0A%23ce8c06%2C%20yellow%20900%0D%0A%23f3f4f4%2C%20gray%20100%0D%0A%23dee1e1%2C%20gray%20200%0D%0A%23c8cccc%2C%20gray%20300%0D%0A%23b0b6b7%2C%20gray%20400%0D%0A%23929a9b%2C%20gray%20500%0D%0A%236e797a%2C%20gray%20600%0D%0A%23515e5f%2C%20gray%20700%0D%0A%23364141%2C%20gray%20800%0D%0A%23273333%2C%20gray%20900%0D%0A%23162020%2C%20black%0D%0A%23fff%2C%20white%0D%0A%2311a7aa%2C%20bambuTeal%20400%0D%0A%23078%2C%20bambuTeal%20500%0D%0A%230f6270%2C%20bambuTeal%20600%0D%0A%230a3f49%2C%20bambuTeal%20700%0D%0A%23f9b450%2C%20bambuYellow%20500%0D%0A%23ffa017%2C%20bambuYellow%20600&foreground-colors=%23FFFFFF%2C%20White%0D%0A%23f3f4f4%2C%20gray%20100%0D%0A%23dee1e1%2C%20gray%20200%0D%0A%23c8cccc%2C%20gray%20300%0D%0A%23b0b6b7%2C%20gray%20400%0D%0A%23929a9b%2C%20gray%20500%0D%0A%236e797a%2C%20gray%20600%0D%0A%23515e5f%2C%20gray%20700%0D%0A%23364141%2C%20gray%20800%0D%0A%23273333%2C%20gray%20900%0D%0A%23162020%2C%20black&es-color-form__tile-size=compact)

### Find the Nearest Color Tool

<form>
  <div>
    <label>
      Color to Match
      <input id="color-closest" type="color" placeholder="#000 or #000000">
    </label>
  </div>
  <div>
    <label>
        Name Format
        <select class="js-colors-name">
          <option value="palette" selected>Palette</option>
          <option value="sass">Sass</option>
          <option value="javascript">Javascript</option>
          <option value="swift">Swift</option>
          <option value="android">Android XML</option>
          <option value="python">Python</option>
        </select>
      </label>
  </div>
  <div>
    <label>
      <input type="checkbox" id="color-include-bambu" checked>
      Include Bambu Brand Colors
    </label>
  </div>
</form>

<h4>Nearest Color</h4>
<div id="color-closest-found" class="Swatch">
  <span><strong><pre id="color-closest-name">Use the color picker above to choose a color to match.</pre></strong></span>
  <span><pre id="color-closest-value"></pre></span>
</div>

<script>
  // TODO: Babel this stuff up
  // TODO: Get rid of all this jQuery and do it with React or at least vanilla JS
  (function($, _, seedsColors) {
    var nearestColorInputEl = document.getElementById('color-closest');
    var nearestColorNameEl = document.getElementById('color-closest-name');
    var nearestColorValueEl = document.getElementById('color-closest-value');
    var $colorFoundSwatch = $('#color-closest-found');

    var colorsWithoutBambu = _.filter(seedsColors, function(color) {
      return color.category != 'bambu';
    });

    function renderColors() {
      var categories = _.uniq(_.map(seedsColors, 'category'));
      var $table = $('#paletteTable');
      var colorsTemplate = _.template($('#colors').html());
      var colorsRowTemplate = _.template($('#colors-row').html());

      _.each(categories, function(category) {
        var rows = _.map(seedsColors, function(color) {
          if (color.category !== category) {
            return;
          }
          if (color.palette == 'Black') {
            color.textColor = '#fff';
          } else {
            var num = Number(color.palette.split(' ')[1]);
            color.textColor = num >= 600 ? '#fff' : '#162020';
          }

          color.num = (num && color.category !== 'bambu') ? 'num'+num : '';

          return colorsRowTemplate(color)
        }).join('');
        $table.append(colorsTemplate({
          rows: rows,
          category: _.upperFirst(category)
        }));
      });

      $('.js-colors-name').on('change', function() {
        $('[data-lang="' + this.value + '"]')
          .show()
          .siblings()
          .hide();
        $('.js-colors-name').val($(this).val());
        updateColor();
      });
    }

    function hexToRgb(hex) {
      // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
      var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
      hex = hex.replace(shorthandRegex, function(m, r, g, b) {
        return r + r + g + g + b + b;
      });
      var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : null;
    };

    function rgbToXyz(rgb) {
      var _r = (rgb.r / 255),
        _g = (rgb.g / 255),
        _b = (rgb.b / 255);

      if (_r > 0.04045) {
        _r = Math.pow(((_r + 0.055) / 1.055), 2.4);
      } else {
        _r = _r / 12.92;
      }

      if (_g > 0.04045) {
        _g = Math.pow(((_g + 0.055) / 1.055), 2.4);
      } else {
        _g = _g / 12.92;
      }

      if (_b > 0.04045) {
        _b = Math.pow(((_b + 0.055) / 1.055), 2.4);
      } else {
        _b = _b / 12.92;
      }

      _r = _r * 100;
      _g = _g * 100;
      _b = _b * 100;

      var X = _r * 0.4124 + _g * 0.3576 + _b * 0.1805,
        Y = _r * 0.2126 + _g * 0.7152 + _b * 0.0722,
        Z = _r * 0.0193 + _g * 0.1192 + _b * 0.9505;

      return [X, Y, Z];
    };

    function xyzToLab(xyz) {
      var ref_X =  95.047,
        ref_Y = 100.000,
        ref_Z = 108.883,
        _X = xyz[0] / ref_X,
        _Y = xyz[1] / ref_Y,
        _Z = xyz[2] / ref_Z;

      if (_X > 0.008856) {
        _X = Math.pow(_X, (1/3));
      } else {
        _X = (7.787 * _X) + (16 / 116);
      }

      if (_Y > 0.008856) {
        _Y = Math.pow(_Y, (1/3));
      } else {
        _Y = (7.787 * _Y) + (16 / 116);
      }

      if (_Z > 0.008856) {
        _Z = Math.pow(_Z, (1/3));
      } else {
        _Z = (7.787 * _Z) + (16 / 116);
      }

      var CIE_L = (116 * _Y) - 16,
        CIE_a = 500 * (_X - _Y),
        CIE_b = 200 * (_Y - _Z);

      return [CIE_L, CIE_a, CIE_b];
    };

    function cie1994(x, y, isTextiles) {
      var x = {l: x[0], a: x[1], b: x[2]},
        y = {l: y[0], a: y[1], b: y[2]},
        labx = x,
        laby = y,
        k2,
        k1,
        kl,
        kh = 1,kc = 1;

      if (isTextiles) {
        k2 = 0.014;
        k1 = 0.048;
        kl = 2;
      } else {
        k2 = 0.015;
        k1 = 0.045;
        kl = 1;
      }

      var c1 = Math.sqrt(x.a * x.a + x.b * x.b),
        c2 = Math.sqrt(y.a * y.a + y.b * y.b),
        sh = 1 + k2 * c1,
        sc = 1 + k1 * c1,
        sl = 1,
        da = x.a - y.a,
        db = x.b - y.b,
        dc = c1 - c2,
        dl = x.l - y.l,
        dh = Math.sqrt(Math.abs(da * da + db * db - dc * dc));

      return Math.sqrt(Math.pow((dl/(kl * sl)),2) + Math.pow((dc/(kc * sc)),2) + Math.pow((dh/(kh * sh)),2));
    };

    function hexToLab(hex) {
      return xyzToLab(rgbToXyz(hexToRgb(hex)));
    };

    $('#paletteTable td, #color-closest-found span').on('click', function() {
      var $this = $(this);
      var $temp = $('<input>');
      var $nameVal = $this.find('pre:visible');
      var val = $nameVal.text();

      $('body').append($temp);
      $temp.val(val).select();
      document.execCommand('copy');
      $nameVal.text('Copied!');
      setTimeout(_.debounce(function() {
        $nameVal.text(val);
      }, 300), 300);
      $temp.remove();
      return;
    });

    renderColors();
    var updateColor = function() {
      var val = $(nearestColorInputEl).val(),
          includeBambu = document.getElementById('color-include-bambu').checked,
          colorsToCheck = includeBambu ? seedsColors : colorsWithoutBambu,
          lab,
          closestColor,
          distance;

      var colorsToCheck = colorsToCheck.filter(color => !color.deprecated);

      if (!val.match(/^#?(?:[0-9a-fA-F]{3}){1,2}$/)) {
        return;
      }

      lab = hexToLab(val);
      closestColor = 0;
      distance = cie1994(lab, hexToLab(colorsToCheck[0].value));

      _.each(colorsToCheck, function(color, i) {
        var thisDistance = cie1994(lab, hexToLab(color.value));
        if (thisDistance < distance) {
          closestColor = i;
          distance = thisDistance;
        }
      });

      nearestColorNameEl.innerText = colorsToCheck[closestColor][$('.js-colors-name').val()];
      nearestColorValueEl.innerText = colorsToCheck[closestColor]['value'];
      var textColor = Number(colorsToCheck[closestColor].palette.split(' ')[1]) >= 500 ? seedsColors.find(color => color.javascript == 'COLOR_NEUTRAL_0').value : seedsColors.find(color => color.javascript == 'COLOR_NEUTRAL_1000').value;

      $colorFoundSwatch.css('background', colorsToCheck[closestColor].value);
      $colorFoundSwatch.css('color', textColor);
    }
    $(nearestColorInputEl).on('input', updateColor);
  })(window.jQuery, window._, window.seedsColors);
</script>